(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{126:function(t,e,s){"use strict";s.r(e),function(t){s(128);var e=s(62),a=s.n(e),n=(s(155),s(118)),o=s.n(n),r=s(119),i=s.n(r);s(257),s(258);new o.a;let c,l=new URL("wss://spark-api.xf-yun.com/v3.5/chat");const h="56673c62";var d="";new i.a;let u=new class{constructor(){let{appId:t=h}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.appId=t,this.status="init"}setStatus(t){this.onWillStatusChange&&this.onWillStatusChange(this.status,t),this.status=t}connectWebSocket(){return this.setStatus("ttsing"),function(){switch(l.pathname){case"/v1.1/chat":c="general";break;case"/v2.1/chat":c="generalv2";break;case"/v3.1/chat":c="generalv3";break;case"/v3.5/chat":c="generalv3.5"}return new Promise((t,e)=>{var s="wss://"+l.host+l.pathname,n=location.host,o=(new Date).toGMTString(),r=`host: ${n}\ndate: ${o}\nGET ${l.pathname} HTTP/1.1`,i=a.a.HmacSHA256(r,"MTUzYzYwZGIxMTc5ZjgxZTg3MDg2OTcy"),c=a.a.enc.Base64.stringify(i);t(s=`${s}?authorization=${btoa(`api_key="50cd1df8cb3ed4fd4f480bde3435ba42", algorithm="hmac-sha256", headers="host date request-line", signature="${c}"`)}&date=${o}&host=${n}`)})}().then(t=>{let e;if("WebSocket"in window)e=new WebSocket(t);else{if(!("MozWebSocket"in window))return void alert("浏览器不支持WebSocket");e=new MozWebSocket(t)}this.ttsWS=e,e.onopen=t=>{this.webSocketSend()},e.onmessage=t=>{this.result(t.data)},e.onerror=e=>{clearTimeout(this.playTimeout),this.setStatus("error"),alert("WebSocket报错，请f12查看详情"),console.error("详情查看："+encodeURI(t.replace("wss:","https:")))},e.onclose=t=>{console.log(t)}})}webSocketSend(){console.log(c);var e={header:{app_id:this.appId,uid:"fd3f47e4-d"},parameter:{chat:{domain:c,temperature:.5,max_tokens:1024}},payload:{message:{text:[{role:"user",content:"中国第一个皇帝是谁？"},{role:"assistant",content:"秦始皇"},{role:"user",content:"秦始皇修的长城吗"},{role:"assistant",content:"是的"},{role:"user",content:t("#input_text").text()}]}}};console.log(JSON.stringify(e)),this.ttsWS.send(JSON.stringify(e))}start(){d="",this.connectWebSocket()}result(e){let s=JSON.parse(e);if(d+=e,t("#output_text").val(d),0!==s.header.code)return alert(`提问失败: ${s.header.code}:${s.header.message}`),void console.error(`${s.header.code}:${s.header.message}`);0===s.header.code&&2===s.header.status&&(this.ttsWS.close(),u.setStatus("init"))}};u.onWillStatusChange=function(e,s){t(".audio-ctrl-btn").removeClass(e).addClass(s).text({init:"立即提问",ttsing:"回答中..."}[s])},t(".audio-ctrl-btn").click((function(){["init","endPlay","errorTTS"].indexOf(u.status)>-1&&u.start()})),t("#input_text").on("input propertychange",(function(){t("#input_text").text(this.value)}))}.call(this,s(127))},258:function(t,e,s){var a=s(259);"string"==typeof a&&(a=[[t.i,a,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};s(36)(a,n);a.locals&&(t.exports=a.locals)},259:function(t,e,s){}},[[261,1,4,0]]]);